name: Build Flutter Windows EXE

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    # Install 7zip (required for extracting Flutter SDK)
    - name: Install 7zip
      run: choco install 7zip -y

    # Download Flutter SDK directly
    - name: Download Flutter SDK
      run: |
        curl -o flutter.zip https://storage.googleapis.com/flutter_infra_release/releases/stable/windows/flutter_windows_3.24.5-stable.zip
        7z x flutter.zip -oC:\

    # Add Flutter to PATH
    - name: Add Flutter to PATH
      shell: pwsh
      run: |
        echo "C:\flutter\bin" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append

    - name: Run flutter doctor
      run: flutter doctor -v

    - name: Enable Windows Desktop
      run: flutter config --enable-windows-desktop

    - name: Get dependencies
      run: flutter pub get

    - name: Build Windows exe
      run: flutter build windows --release

    - name: Upload EXE artifact
      uses: actions/upload-artifact@v4
      with:
        name: henson-field-app-windows
        path: build/windows/runner/Release/
